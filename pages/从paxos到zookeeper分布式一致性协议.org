* 一致性协议
** 2PC/3PC
*** 2PC
**** 执行流程
{: id="20210727150251-ximeeq6" updated="20210726160000"}
**** 1. {: id="20210727150251-i1l484j"}提交事务请求
 {: id="20210727150251-flh5uwn" updated="20210726160457"}
**** 1. {: id="20210727150251-x5zuqd8"}事务询问
    {: id="20210727150251-020e8tx" updated="20210726160445"}
**** 协调者向事务参与者发送事务内容, 询问是否可以执行事务提交动作, 并开始等待各参与者的回应
    {: id="20210727150251-aiyw05y" updated="20210726160146"}
 2. {: id="20210727150251-jv6hiq1"}执行事务
    {: id="20210727150251-vnba9g7" updated="20210726160151"}
**** 各参与者执行事务,并将Undo和Redo信息记入事务日志
    {: id="20210727150251-inoa11c" updated="20210726160232"}
 3. {: id="20210727150251-gy65ls3"}各参与者响应协调者的事务询问
    {: id="20210727150251-4gxrboa" updated="20210726160639"}
 {: id="20210727150251-vj3fukl"}
**** 这个过程近似一次对事务操作的投票, 所以被称为`投票阶段`
 {: id="20210727150251-en34t36" updated="20210726160740"}
2. {: id="20210727150251-0oi3rkv"}执行事务提交
 {: id="20210727150251-r1c816u" updated="20210726160757"}
**** 根据各个节点返回的确认信息, 决定事务是否提交
 {: id="20210727150251-gixkqz3" updated="20210726160940"}
**** 1. {: id="20210727150251-tkk9ro4"}提交事务
    {: id="20210727150251-9w8gikk" updated="20210726160945"}
**** 1. {: id="20210727150251-4fhyts6"}发送提交请求
       {: id="20210727150251-w49auq0" updated="20210726161020"}
    2. {: id="20210727150251-px4ki0l"}事务提交
       {: id="20210727150251-wbi055k" updated="20210726161025"}
    3. {: id="20210727150251-dqqaxo9"}反馈事务提交结果
       {: id="20210727150251-4rr9lv5" updated="20210726161037"}
    4. {: id="20210727150251-qtm0gqr"}完成事务
       {: id="20210727150251-ms6435r" updated="20210726161042"}
    {: id="20210727150251-6059w29" updated="20210726161015"}
 2. {: id="20210727150251-enkkmc1"}中断事务
    {: id="20210727150251-z9xrorf" updated="20210726160952"}
**** 如果未收到YES返回或者超时, 中断事务
    {: id="20210727150251-t8lc547" updated="20210726161140"}
**** 1. {: id="20210727150251-z0merz8"}发送回滚请求
       {: id="20210727150251-2z9cksu" updated="20210726161152"}
    2. {: id="20210727150251-kqcb9kh"}事务回滚
       {: id="20210727150251-bzi30pl" updated="20210726161200"}
    3. {: id="20210727150251-rlxjog1"}反馈事务回滚结果
       {: id="20210727150251-wr26hwv" updated="20210726161210"}
    4. {: id="20210727150251-egf9jcx"}中断事务
       {: id="20210727150251-it3weh4" updated="20210726161218"}
    {: id="20210727150251-9uniy1k" updated="20210726161144"}
 {: id="20210727150251-742zz7m"}
{: id="20210727150251-afsiemt" updated="20210726160332"}